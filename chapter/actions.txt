= Actions

In this chapter we will see what role Actions play within Ramaze, as usual we
will see a bit of history first, then go on to look at the structure of the
Action Struct, eventually creating our own Actions.


== History

Actions were first introduced around Summer 2007, the intention behind this
change was to bundle a template, a method, and the parameters to the method
into one Object that could be easily passed around and modified.

Over time, this brought with it a change of the role of the Controller, which
did everything from routing to rendering and grew quite large.

Eventually, the rendering part was ripped out of Controller, and put into the
Action class, and further changes made the Action pass itself to the template
rendering.

The role of the Controller became to build the Action depending on the state of
the Controller. The Controller would still do most of the routing, but how that
changed is probably better explained in the chapter about controllers.

Today, Action still resembles the original Action from 2007, but has been
expanded as there were additions like aspects and layouts.


== Structure

The Action class is an instance of the Struct class, with following members:

|===============================================================================
| engine       | The templating engine called during rendering
| instance     | Lazily created instance of the node
| layout       | Array consisting of the type and name of the layout
| method       | Name of the instance-method called on instance during rendering
| node         | Class that the instance will be instantiated from
| options      | Hash with options and meta-information for the engine
| params       | Array of parameters for the instance-method used for the call
| method_value | The return value of the instance-method, set during rendering
| variables    | Hash of instance-variables usable in the method and templates
| view         | String with the full path to a file used as view-template
| view_value   | Contents of the view-template file
| wish         | Indicates the requested content-representation
|===============================================================================

Most of these members are not of interest for the average user, but they become
increasingly interesting if you try doing partial rendering of actions.


== Creating actions

If you try to learn more about the internals of Ramaze, you will need to
understand Actions, if you are not interested in this, feel free to skip this
section.

=== The hard way

The theoretical knowledge from above is of course not very valuable if you don't
have had any previous experience with Ramaze, so I'll give you a quick rundown
to creating a simple Action for a small example.

[source,ruby]
--------------------------------------------------------------------------------
::include:chapter/source/action/create_actions/the_hard_way/index.xmp[tabsize=2]
--------------------------------------------------------------------------------

Similarly we can create an Action for the sum method:

[source,ruby]
--------------------------------------------------------------------------------
::include:chapter/source/action/create_actions/the_hard_way/sum.xmp[tabsize=2]
--------------------------------------------------------------------------------

I will not go into much detail about these examples, as I think they can speak
for themselves.  
You will soon see more information about the methods involved in the rendering
of an Action.
If you want to see the Action automatically created during normal runtime of
Ramaze you can use the `Current.action` or simply `action` methods in your
Controller and inspect the returned value.
It is also possible to change parts of the Action at this stage, allowing you to
influence details of the rendering process.

== The easy way

It's quite tedious to do all this work of creating actions manually when Ramaze
can simply do it for you. It's just good to gain an understanding, so let's
create the same actions as in the examples above, this time using the
`Node#resolve` method which is also available in controllers.

[source,ruby]
--------------------------------------------------------------------------------
::include:chapter/source/action/create_actions/the_easy_way/sum.xmp[tabsize=2]
--------------------------------------------------------------------------------


=== Action#method

Refers to the name of the method to be invoked before a template is evaluated.

The return value of the method is kept as the result of Action#render if there is no Action#template.

=== Action#params

The parameter are part of the `#__send__` to Action#method. You can visualize this as:

[source,ruby]
--------------------------------------------------------------------------------
if method = action.method
  action.instance.__send__(method, *action.params)
end
--------------------------------------------------------------------------------

In Lisp/Scheme terms, they are being applied.

Please note that the params are given as Strings due to the fact that they are extracted from the URI of the HTTP method and so Ramaze has no chance of determining what kind of Object this should represent.

=== Action#template

If there is a template found during the procedure of finding a fitting Action for the given request, this member is set to the relative path from your Global.view_root or Controller.view_root directory. The template is evaluated unless the templating engine is set to :None and the result of this evaluation is set as the response.body.

=== Action#controller

Points to the controller this Action operates on, also see Action#instance.

=== Action#path

A String represenation of the Action without params, generally it's the name of the method or (if no method but a template found) the name of the template without extension. It's used for different kinds of hooks.

=== Action#binding

The binding to the `Action#instance`, obtained by doing an `instance_eval{ binding }` on it. This is only done when the binding hasn't been set yet.

=== Action#engine

Refers to the templating engine that this Action is passed to when `Action#render` is called.

=== Action#instance

Instance of the Controller, lazily obtained through `Action#controller.new` on access of this member. Note that this is also invoked as a dependency of `Action#binding`.

== Create an Action

Creating an Action can be verbose and is usually not required outside the direct proximity within the codeflow.

    action = Ramaze::Action(:controller => MainController)
{:ruby}


== Render an Action

We did all this just to render an Action, so let's do that already.

[source,ruby]
--------------------------------------------------------------------------------
class MainController < Ramaze::Controller
  def index
    "Hello, World!"
  end
end

Ramaze::Action(:controller => MainController, :method => :index).render
# => "Hello, World!"
--------------------------------------------------------------------------------
